#
# CIP Core, generic profile
#
# Copyright (c) Siemens AG, 2019-2024
#
# Authors:
#  Jan Kiszka <jan.kiszka@siemens.com>
#
# SPDX-License-Identifier: MIT
#

header:
  version: 14

distro: cip-core-bookworm
target: cip-core-image

build_system: isar

defaults:
  repos:
    patches:
      repo: cip-core

repos:
  cip-core:

  isar:
    url: https://github.com/ilbers/isar.git
    commit: 36b04737a07baafc5af64cdc8aa61fad13fb494a
    patches:
      01:
        path: isar-patches/0001-image-Avoid-breaking-the-build-when-mounts-are-no-lo.patch
      02:
        path: isar-patches/0002-rootfs-Provide-rootfs_do_umounts.patch
      03:
        path: isar-patches/0003-initramfs-Add-missing-umounts-after-generation.patch
      04:
        path: isar-patches/0004-rootfs-Add-missing-umounts-in-rootfs_postprocess-and.patch
    layers:
      meta:

bblayers_conf_header:
  standard: |
    LCONF_VERSION = "6"

local_conf_header:
  standard: |
    CONF_VERSION = "1"
  cross: |
    ISAR_CROSS_COMPILE = "1"
  ccache: |
    USE_CCACHE = "1"
  root_password: |
    USERS += "root"
    USER_root[password] = "root"
    USER_root[flags] = "clear-text-password"
  source_epoch: |
    SOURCE_DATE_EPOCH_FALLBACK := "${@bb.process.run("git -C ${LAYERDIR_cip-core} log -1 --pretty=%ct | tr -d '\n'")[0]}"

env:
  DISTRO_APT_PREMIRRORS: ""
